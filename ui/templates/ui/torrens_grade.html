{% extends "ui/base.html" %}
{% block title %}Baholash — {{ test.title }}{% endblock %}
{% block nav_torrens_active %}active{% endblock %}
{% block content %}
<div class="container py-4">
  <h3 class="mb-3">{{ test.title }} — Baholash</h3>

  <form method="post">
    {% csrf_token %}
    {% for ans in submission.answers.select_related "task" %}
      <div class="card mb-3">
        <div class="card-body">
          <div class="mb-2"><strong>{{ forloop.counter }}. {{ ans.task.prompt }}</strong></div>

          {% if ans.task.response_type == 'text' %}
            <div class="p-2 bg-light rounded">{{ ans.text_answer|linebreaks }}</div>
          {% elif ans.task.response_type == 'list' %}
            {% if ans.list_answer %}
              <ul class="mb-0">
                {% for row in ans.list_answer %}
                  <li>{{ row }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <em>—</em>
            {% endif %}
          {% elif ans.task.response_type == 'drawing' %}
            {% if ans.drawing_image %}
              <img src="{{ ans.drawing_image.url }}" class="img-fluid" alt="drawing">
            {% else %}
              <em>—</em>
            {% endif %}
          {% endif %}

          <div class="row g-2 mt-3">
            <div class="col-sm-3">
              <input type="number" step="0.1" name="score_{{ ans.id }}" class="form-control" placeholder="Ball" value="{{ ans.score }}">
            </div>
            <div class="col-sm-9">
              <input type="text" name="note_{{ ans.id }}" class="form-control" placeholder="Izoh" value="{{ ans.note }}">
            </div>
          </div>
        </div>
      </div>
    {% endfor %}

    <button class="btn btn-primary">Bahoni saqlash</button>
  </form>

  <div class="mt-3">
    Jami ball: <strong>{{ submission.total_score }}</strong> — Status: <span class="badge bg-secondary">{{ submission.status }}</span>
  </div>
</div>
{% endblock %}
